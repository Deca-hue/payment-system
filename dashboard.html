<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Money App ‚Äî Dashboard (Actions + Detailed Modals)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* small extras */
    .glass { background: rgba(255,255,255,0.6); backdrop-filter: blur(6px); }
    .pulse { animation: pulse 1.6s infinite; }
    @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(239,68,68,0.8);} 70% { box-shadow: 0 0 0 10px rgba(239,68,68,0);} 100% { box-shadow: 0 0 0 0 rgba(239,68,68,0);} }
    /* panel slide helpers */
    .panel-wrap { position: relative; overflow: hidden; }
    .slide-base { position: absolute; inset:0; }
    .slide-in { transform: translateX(0%); transition: transform 360ms cubic-bezier(.2,.8,.2,1); }
    .slide-out-right { transform: translateX(100%); transition: transform 360ms cubic-bezier(.2,.8,.2,1); }
    .slide-out-left { transform: translateX(-100%); transition: transform 360ms cubic-bezier(.2,.8,.2,1); }
    /* centered modal background blur */
    .modal-backdrop { 
      backdrop-filter: blur(6px); 
      background: rgba(0,0,0,0.45);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    /* Modal fixes */
    .modal-content {
      background: white;
      border-radius: 0.5rem;
      padding: 1.5rem;
      width: 100%;
      max-width: 28rem;
      position: relative;
    }
    .pin-modal {
      z-index: 9999 !important;
    }
    .action-modal {
      z-index: 9998 !important;
    }
    /* tiny shake */
    @keyframes shake { 0% { transform: translateX(0);} 25% { transform: translateX(-6px);} 50% { transform: translateX(4px);} 75% { transform: translateX(-2px);} 100% { transform: translateX(0);} }
  
  </style>
</head>
<body class="bg-gradient-to-b from-slate-50 to-slate-100 min-h-screen font-sans">

  <!-- Top navbar -->
  <header class="flex items-center justify-between px-4 py-3 shadow-sm bg-white/70 sticky top-0 z-40">
    <div class="flex items-center gap-4">
      <div class="flex items-center gap-2">
        <div class="w-10 h-10 bg-indigo-600 text-white rounded flex items-center justify-center font-bold">MA</div>
        <div>
          <div class="text-sm font-semibold">Money App</div>
          <div class="text-xs text-slate-500">Demo dashboard</div>
        </div>
      </div>
    </div>

      <!-- SEND Modal (quick action) -->
      <div id="sendModal" class="hidden fixed inset-0 z-60 modal-backdrop flex items-center justify-center p-4">
        <div class="bg-white rounded-lg p-6 w-full max-w-md">
          <h3 class="text-lg font-semibold mb-3">Send Money</h3>
          <div class="space-y-3">
            <div>
              <label class="text-xs text-slate-600">Recipient (phone or account)</label>
              <input id="send_recipient" class="w-full border p-2 rounded" placeholder="2547XXXXXXXX or Account name" />
            </div>
            <div>
              <label class="text-xs text-slate-600">Amount (KES)</label>
              <input id="send_amount" type="number" class="w-full border p-2 rounded" placeholder="Amount" />
            </div>
            <div>
              <label class="text-xs text-slate-600">Note (optional)</label>
              <input id="send_note" class="w-full border p-2 rounded" placeholder="For rent, lunch, ..." />
            </div>
          </div>
          <div class="flex gap-2 mt-4">
            <button class="flex-1 bg-indigo-600 text-white py-2 rounded" onclick="openPinFromModal('send')">Proceed</button>
            <button class="flex-1 py-2 rounded border" onclick="closeAllActionModals()">Cancel</button>
          </div>
        </div>
      </div>

      <!-- WITHDRAW Modal (quick action) -->
      <div id="withdrawModal" class="hidden fixed inset-0 z-60 modal-backdrop flex items-center justify-center p-4">
        <div class="bg-white rounded-lg p-6 w-full max-w-md">
          <h3 class="text-lg font-semibold mb-3">Withdraw</h3>
          <div class="space-y-3">
            <div>
              <label class="text-xs text-slate-600">Withdraw to (cash / agent / account)</label>
              <input id="withdraw_target" class="w-full border p-2 rounded" placeholder="Agent ID or Cash" />
            </div>
            <div>
              <label class="text-xs text-slate-600">Amount (KES)</label>
              <input id="withdraw_amount" type="number" class="w-full border p-2 rounded" placeholder="Amount" />
            </div>
            <div>
              <label class="text-xs text-slate-600">Note (optional)</label>
              <input id="withdraw_note" class="w-full border p-2 rounded" placeholder="For pickup, reference..." />
            </div>
          </div>
          <div class="flex gap-2 mt-4">
            <button class="flex-1 bg-indigo-600 text-white py-2 rounded" onclick="openPinFromModal('withdraw')">Proceed</button>
            <button class="flex-1 py-2 rounded border" onclick="closeAllActionModals()">Cancel</button>
          </div>
        </div>
      </div>

    <div class="flex items-center gap-3">
      <div class="relative" id="notifDropdownWrap">
        <button id="notifBtn" aria-label="Notifications" class="p-2 rounded hover:bg-slate-100 relative">
          <span id="bellIcon" class="text-xl">üîî</span>
        </button>
        <span id="notifBadge" class="hidden absolute -top-1 -right-1 bg-red-500 text-white text-xs px-1 rounded-full"></span>
        <!-- Dropdown for notifications -->
        <div id="notifDropdown" class="hidden flex-col absolute right-0 top-10 bg-white border rounded shadow-lg min-w-[260px] max-h-80 overflow-y-auto z-50">
          <div class="flex items-center justify-between px-4 py-2 border-b">
            <span class="font-semibold text-sm">Notifications</span>
            <button onclick="clearNotifs()" class="text-xs text-indigo-600">Clear</button>
          </div>
          <div id="notifDropdownList" class="text-sm text-slate-600 max-h-60 overflow-y-auto">
            <!-- notifications will be injected here -->
          </div>
        </div>
      </div>

      <div class="hidden md:flex items-center gap-2 text-sm text-slate-600 relative group cursor-pointer" id="profileDropdownTrigger">
        <div id="navUserName" class="font-medium">User</div>
        <div id="avatarInitial" class="w-8 h-8 rounded-full bg-indigo-200 flex items-center justify-center text-indigo-700 font-semibold">U</div>
        <!-- Dropdown -->
        <div id="profileDropdown" class="hidden group-hover:flex flex-col absolute right-0 top-10 bg-white border rounded shadow-lg min-w-[160px] z-50">
          <button onclick="showChangePinModal()" class="px-4 py-2 text-left hover:bg-slate-100 w-full">Change PIN</button>
          <button onclick="logout()" class="px-4 py-2 text-left hover:bg-slate-100 w-full">Switch Account</button>
        </div>
  <!-- Change PIN Modal -->
  <div id="changePinModal" class="hidden fixed inset-0 z-70 modal-backdrop flex items-center justify-center p-4">
    <div class="bg-white rounded-lg p-6 w-full max-w-sm">
      <h3 class="text-lg font-semibold mb-3">Change PIN</h3>
      <div class="space-y-3">
        <div>
          <label class="text-xs text-slate-600">Old PIN</label>
          <input id="oldPinInput" type="password" maxlength="6" class="w-full border p-2 rounded" placeholder="Current PIN" />
        </div>
        <div>
          <label class="text-xs text-slate-600">New PIN</label>
          <input id="newPinInput" type="password" maxlength="6" class="w-full border p-2 rounded" placeholder="New PIN" />
        </div>
        <div>
          <label class="text-xs text-slate-600">Confirm New PIN</label>
          <input id="confirmNewPinInput" type="password" maxlength="6" class="w-full border p-2 rounded" placeholder="Confirm New PIN" />
        </div>
        <p id="changePinMsg" class="text-sm mt-1 text-red-500 hidden"></p>
      </div>
      <div class="flex gap-2 mt-4">
        <button class="flex-1 bg-indigo-600 text-white py-2 rounded" onclick="saveNewPin()">Save</button>
        <button class="flex-1 py-2 rounded border" onclick="closeChangePinModal()">Cancel</button>
      </div>
    </div>
  </div>
      </div>

      <button onclick="logout()" class="bg-red-500 text-white px-3 py-1 rounded text-sm">Logout</button>
    </div>
  </header>

  <div class="flex h-[calc(100vh-64px)]">
    <!-- Sidebar -->
    <aside id="sidebar" class="hidden md:flex flex-col gap-4 p-4 w-72 bg-white/60 border-r">
      <div>
        <div class="text-sm text-slate-500">Welcome back</div>
        <div class="text-xl font-bold" id="animatedName">User</div>
        <div class="text-xs text-slate-400 mt-1" id="lastSeen">Last seen: now</div>
      </div>

      <div>
        <div class="flex items-center justify-between mb-2">
          <div class="text-sm font-semibold">Your Accounts</div>
          <button class="text-xs text-indigo-600" onclick="showAddAccount()">+ Add</button>
        </div>
        <div id="accountsList" class="space-y-2 max-h-56 overflow-auto pr-1"></div>
      </div>
<!-- SETTINGS MODAL -->
<div id="settingsModal" class="hidden fixed inset-0 z-80 modal-backdrop flex items-center justify-center p-4">
  <div class="bg-white rounded-lg p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto">
    <h3 class="text-xl font-semibold mb-4">Settings</h3>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <!-- Left Column -->
      <div>
        <!-- Profile Section -->
        <div class="mb-6">
          <h4 class="text-sm font-semibold mb-3 text-slate-700">Profile</h4>
          
          <!-- Avatar -->
          <div class="mb-4">
            <label class="text-xs text-slate-600">Avatar</label>
            <div class="flex items-center gap-3 mt-1">
              <img id="avatarPreview" src="" alt="avatar" class="w-12 h-12 rounded-full object-cover border bg-slate-50" />
              <div>
                <input id="avatarInput" type="file" accept="image/*" class="text-sm" />
                <p class="text-xs text-slate-400 mt-1">Small image recommended (max ~200KB)</p>
              </div>
            </div>
          </div>

          <div class="space-y-3">
            <div>
              <label class="text-xs text-slate-600">Full Name</label>
              <input id="set_name" class="w-full border p-2 rounded mt-1" />
            </div>

           <div class="relative group">
  <label class="text-xs text-slate-600">Phone Number</label>

  <input 
    id="set_phone"
    type="tel"
    class="w-full border p-2 rounded mt-1 bg-white text-black 
           cursor-not-allowed opacity-100"
    readonly
  />

  <!-- Lock Icon -->
  <svg class="w-5 h-5 text-slate-500 absolute right-3 top-9 pointer-events-none" 
       fill="none" stroke="currentColor" stroke-width="2" 
       viewBox="0 0 24 24">
       <path stroke-linecap="round" stroke-linejoin="round"
        d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 10-8 0v4h8z"/>
  </svg>

  <!-- Tooltip -->
  <div class="absolute right-0 top-0 mt-1 mr-8 hidden group-hover:block
              bg-black text-white text-xs rounded py-1 px-2 shadow-lg">
    Phone number cannot be changed
  </div>
</div>
          </div>
        </div>

        <!-- Security Section -->
        <div>
          <h4 class="text-sm font-semibold mb-3 text-slate-700">Security</h4>
          
          <div class="space-y-3">
            <div>
            <!-- Hidden PIN input to preserve code logic, but not visible to users -->
            <input id="set_pin" type="password" maxlength="6" class="w-full border p-2 rounded mt-1" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" style="display:none;" />
            <label class="text-xs text-slate-400">Use the Change PIN button </label>
            </div>


<!-- Security recovery question (add to Security section) -->
<div class="mt-3">
  <label class="text-xs text-slate-600">Recovery Question</label>
  <select id="recovery_q" class="w-full border p-2 rounded mb-2">
    <option value="">‚Äî choose a question ‚Äî</option>
    <option value="mother_maiden">What is your mother's maiden name?</option>
    <option value="first_school">What was your first school's name?</option>
    <option value="fav_teacher">What is your favorite teacher's name?</option>
  </select>
  <input id="recovery_a" class="w-full border p-2 rounded" placeholder="Answer (keep secret)" />
  <p class="text-xs text-slate-400 mt-1">Use this to recover/reset PIN if locked.</p>
  </div>
     </div>
       </div>
         </div>

      <!-- Right Column -->
      <div>
        <!-- Appearance Section -->
        <div class="mb-6">
          <h4 class="text-sm font-semibold mb-3 text-slate-700">Appearance</h4>
          
          <div class="space-y-4">
            <div>
              <label class="text-xs text-slate-600 block mb-2">Theme</label>
              <select id="themeSelect" class="w-full border p-2 rounded text-sm">
                <option value="default">Default</option>
                <option value="purple">Purple</option>
                <option value="blue">Blue</option>
                <option value="dark">Dark</option>
                <option value="amoled">AMOLED</option>
              </select>
            </div>

            <div class="flex items-center gap-3">
              <label class="text-xs text-slate-600">Dark Mode</label>
              <button id="darkToggle" class="px-3 py-1 bg-slate-200 rounded-full text-xs">
                Off
              </button>
            </div>
          </div>
        </div>

        <!-- Danger Zone -->
        <div>
          <h4 class="text-sm font-semibold mb-3 text-red-600">Danger Zone</h4>
          <button onclick="openDeleteAccountConfirm()"
            class="w-full bg-red-600/90 hover:bg-red-600 text-white py-2 rounded shadow transition">
            Delete Account
          </button>
          <p class="text-xs text-slate-400 mt-2">This action cannot be undone.</p>
            <!-- Change PIN (duplicate, always visible in settings) -->
            <button onclick="showChangePinModal()" class="w-full bg-indigo-600 text-white py-2 rounded mt-4 shadow transition">Change PIN</button>
        </div>
      </div>
    </div>

    <!-- Bottom Buttons -->
    <div class="flex gap-3 mt-6 pt-4 border-t">
      <button class="flex-1 bg-indigo-600 text-white py-2 rounded hover:bg-indigo-700 transition" onclick="saveSettings()">Save Changes</button>
      <button class="flex-1 py-2 rounded border hover:bg-slate-50 transition" onclick="closeSettings()">Cancel</button>
    </div>
  </div>
</div>

<!-- DELETE ACCOUNT CONFIRM -->
<div id="deleteAccountModal" class="hidden fixed inset-0 z-90 modal-backdrop flex items-center justify-center p-4">
  <div class="bg-white rounded-lg p-6 w-full max-w-sm">
    <h3 class="text-lg font-semibold mb-3">Delete Account?</h3>
    <p class="text-sm text-slate-600 mb-3">This action cannot be undone.</p>

    <div class="flex gap-2">
      <button class="flex-1 bg-red-600 text-white py-2 rounded" onclick="confirmDeleteAccount()">Delete</button>
      <button class="flex-1 py-2 rounded border" onclick="closeDeleteAccountConfirm()">Cancel</button>
    </div>
  </div>
</div>

      <div class="mt-auto">
        <button class="w-full text-left px-3 py-2 rounded hover:bg-slate-100" onclick="openSettings()">‚öôÔ∏è Settings</button>
        <button class="w-full text-left px-3 py-2 rounded hover:bg-slate-100 text-red-600" onclick="logout()">‚èª Logout</button>
      </div>
    </aside>

    <!-- Main -->
    <main class="flex-1 p-4 overflow-auto">
  <div class="max-w-4xl mx-auto space-y-6">

  <!-- ACTION MODAL (Send/Withdraw/Deposit) -->
  <div id="actionModal" class="hidden fixed inset-0 modal-backdrop action-modal">
    <div class="modal-content">
      <h3 id="actionTitle" class="text-lg font-semibold mb-3">Action</h3>
      <div id="actionForm">
        <div id="recipientField" class="mb-3">
          <label class="text-xs text-slate-600">Recipient (phone or account)</label>
          <input id="recipientInput" class="w-full border p-2 rounded" placeholder="2547XXXXXXXX or Account name">
        </div>
        <label class="text-xs text-slate-600">Amount (KES)</label>
        <input id="amountInput" type="number" class="w-full border p-2 rounded mb-3" placeholder="Amount">
        <label class="text-xs text-slate-600">Note (optional)</label>
        <input id="noteInput" class="w-full border p-2 rounded mb-3" placeholder="For rent, lunch, ..." />
      </div>
      <div class="flex gap-2 mt-4">
        <button id="confirmActionBtn" class="flex-1 bg-indigo-600 text-white py-2 rounded">Confirm</button>
        <button class="flex-1 py-2 rounded border" id="closeActionModalBtn">Cancel</button>
      </div>
    </div>
  </div>

        <!-- ACCOUNT SUMMARY -->
        <section class="grid md:grid-cols-3 gap-4 items-start">
          <div class="md:col-span-2 bg-white p-5 rounded-lg shadow flex flex-col gap-3">
            <div class="flex items-center justify-between">
              <div>
                <div class="text-xs text-slate-500">Active Account</div>
                <div class="text-lg font-semibold" id="activeAccountName">Main</div>
                <div class="text-xs text-slate-400">Switch accounts from the sidebar</div>
              </div>

              <div class="text-right">
                <div class="text-xs text-slate-500">Balance</div>
                <div id="activeBalance" class="text-3xl font-bold">KES 0</div>
                <div class="text-xs text-slate-400" id="balanceUpdated">Updated: now</div>
              </div>
            </div>

            <div class="flex gap-3 mt-3">
              <button onclick="startAction('send')" class="flex-1 bg-blue-600 text-white py-2 rounded shadow">Send</button>
              <button onclick="startAction('withdraw')" class="flex-1 bg-yellow-500 text-white py-2 rounded shadow">Withdraw</button>
              <button onclick="startAction('deposit')" class="flex-1 bg-green-600 text-white py-2 rounded shadow">Deposit</button>
            </div>
          </div>

          <div class="bg-white p-4 rounded-lg shadow flex flex-col gap-3">
            <div class="flex items-center justify-between">
              <div class="text-sm font-semibold">Notifications</div>
              <button onclick="clearNotifs()" class="text-xs text-indigo-600">Clear</button>
            </div>
            <div class="relative">
              <div id="notificationsList" class="text-sm text-slate-600 max-h-[60px] overflow-y-auto scrollbar-thin pr-1 hover:max-h-[120px] transition-all duration-300">No new notifications</div>
              <div class="absolute bottom-0 left-0 right-0 h-6 bg-gradient-to-t from-white to-transparent pointer-events-none"></div>
            </div>

            <hr class="my-2">
            <div class="text-sm font-semibold">Shortcuts</div>
            <div class="grid grid-cols-2 gap-2 mt-2">
              <button class="py-2 rounded border text-sm" onclick="openQrMock()">QR Pay</button>
              <button class="py-2 rounded border text-sm" onclick="openBills()">Pay Bills</button>
              <button class="col-span-2 py-2 rounded border text-sm" onclick="openSupport()">Support</button>
            </div>
          </div>
        </section>

        <!-- Actions vs Notifications wrapper -->
        <section class="bg-white p-0 rounded-lg shadow flex flex-col md:flex-row overflow-hidden" style="min-height:420px;">
          <!-- Left: Money Actions -->
          <div class="flex-1 p-6 bg-gradient-to-b from-indigo-50 to-white flex flex-col gap-6 justify-center">
            <h3 class="font-semibold text-lg mb-2">Quick Actions</h3>
            <div class="grid grid-cols-2 gap-4">
              <button class="flex flex-col items-center p-4 rounded-xl bg-white shadow hover:bg-indigo-50 transition group" onclick="startAction('bank')">
                <span class="text-3xl mb-2">üè¶</span>
                <span class="font-medium">Send to Bank</span>
                <span class="text-xs text-slate-500 mt-1">Bank transfer</span>
              </button>
              <button class="flex flex-col items-center p-4 rounded-xl bg-white shadow hover:bg-indigo-50 transition group" onclick="startAction('paypal')">
                <span class="text-3xl mb-2">üí≥</span>
                <span class="font-medium">Send to PayPal</span>
                <span class="text-xs text-slate-500 mt-1">PayPal transfer</span>
              </button>
              <button class="flex flex-col items-center p-4 rounded-xl bg-white shadow hover:bg-indigo-50 transition group" onclick="startAction('agent')">
                <span class="text-3xl mb-2">üè™</span>
                <span class="font-medium">Withdraw Agent</span>
                <span class="text-xs text-slate-500 mt-1">Agent cashout</span>
              </button>
              <button class="flex flex-col items-center p-4 rounded-xl bg-white shadow hover:bg-indigo-50 transition group" onclick="startAction('mpesa')">
                <span class="text-3xl mb-2">üì±</span>
                <span class="font-medium">Lipa na M-Pesa</span>
                <span class="text-xs text-slate-500 mt-1">STK Push</span>
              </button>
              <button class="flex flex-col items-center p-4 rounded-xl bg-white shadow hover:bg-indigo-50 transition group col-span-2" onclick="startAction('bills')">
                <span class="text-3xl mb-2">üìÑ</span>
                <span class="font-medium">Pay Bills</span>
                <span class="text-xs text-slate-500 mt-1">Utilities & services</span>
              </button>
            </div>
          </div>
          <!-- Right: Activity Feed
          <div class="w-full md:w-96 border-l bg-white flex flex-col">
            <div class="flex items-center justify-between px-6 pt-6 pb-2">
              <h3 class="font-semibold text-lg">Activity</h3>
              <button class="text-xs text-indigo-600" onclick="showActionsFromNotif()">Show Actions</button>
            </div>
            <div id="txContainer" class="flex-1 overflow-auto px-6 pb-6" style="max-height:360px;">
              <p class="text-slate-500">Loading transactions...</p>
            </div>
          </div> -->
        </section>

      </div>
    </main>
  </div>

  <!-- ------------------------
       CENTERED DETAILED MODALS
       ------------------------ -->

  <!-- Send to Bank Modal -->
  <div id="bankModal" class="hidden fixed inset-0 z-60 modal-backdrop flex items-center justify-center p-4">
    <div class="bg-white rounded-lg p-6 w-full max-w-lg">
      <h3 class="text-lg font-semibold mb-2">Send to Bank</h3>
      <p class="text-sm text-slate-500 mb-3">Fill bank details below.</p>

      <div class="space-y-2">
        <div>
          <label class="text-xs text-slate-600">Bank Name</label>
          <input id="bank_name" class="w-full border p-2 rounded" placeholder="e.g., KCB" />
        </div>
        <div>
          <label class="text-xs text-slate-600">Account Number</label>
          <input id="bank_account" class="w-full border p-2 rounded" placeholder="Account number" />
        </div>
        <div class="grid grid-cols-2 gap-2">
          <div>
            <label class="text-xs text-slate-600">Bank Code (optional)</label>
            <input id="bank_code" class="w-full border p-2 rounded" placeholder="e.g., 01" />
          </div>
          <div>
            <label class="text-xs text-slate-600">Amount (KES)</label>
            <input id="bank_amount" type="number" class="w-full border p-2 rounded" placeholder="Amount" />
          </div>
        </div>
        <div>
          <label class="text-xs text-slate-600">Note</label>
          <input id="bank_note" class="w-full border p-2 rounded" placeholder="Optional note" />
        </div>
      </div>

      <div class="flex gap-2 mt-4">
        <button class="flex-1 bg-indigo-600 text-white py-2 rounded" onclick="openPinFromModal('bank')">Proceed</button>
        <button class="flex-1 py-2 rounded border" onclick="closeAllActionModals()">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Send to PayPal Modal -->
  <div id="paypalModal" class="hidden fixed inset-0 z-60 modal-backdrop flex items-center justify-center p-4">
    <div class="bg-white rounded-lg p-6 w-full max-w-md">
      <h3 class="text-lg font-semibold mb-2">Send to PayPal</h3>
      <p class="text-sm text-slate-500 mb-3">Enter PayPal email and amount.</p>

      <div class="space-y-2">
        <div>
          <label class="text-xs text-slate-600">PayPal Email</label>
          <input id="paypal_email" class="w-full border p-2 rounded" placeholder="email@example.com" />
        </div>
        <div>
          <label class="text-xs text-slate-600">Amount (KES)</label>
          <input id="paypal_amount" type="number" class="w-full border p-2 rounded" placeholder="Amount" />
        </div>
        <div>
          <label class="text-xs text-slate-600">Note</label>
          <input id="paypal_note" class="w-full border p-2 rounded" placeholder="Optional note" />
        </div>
      </div>

      <div class="flex gap-2 mt-4">
        <button class="flex-1 bg-indigo-600 text-white py-2 rounded" onclick="openPinFromModal('paypal')">Proceed</button>
        <button class="flex-1 py-2 rounded border" onclick="closeAllActionModals()">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Withdraw from Agent Modal -->
  <div id="agentModal" class="hidden fixed inset-0 z-60 modal-backdrop flex items-center justify-center p-4">
    <div class="bg-white rounded-lg p-6 w-full max-w-md">
      <h3 class="text-lg font-semibold mb-2">Withdraw from Agent</h3>
      <p class="text-sm text-slate-500 mb-3">Choose agent location and amount.</p>

      <div class="space-y-2">
        <div>
          <label class="text-xs text-slate-600">Agent</label>
          <select id="agent_select" class="w-full border p-2 rounded">
            <option value="">Select agent location</option>
            <option value="AG-001|Downtown Agent">AG-001 ‚Äî Downtown Agent</option>
            <option value="AG-021|Mall Agent">AG-021 ‚Äî Mall Agent</option>
            <option value="AG-092|Corner Shop Agent">AG-092 ‚Äî Corner Shop Agent</option>
          </select>
        </div>
        <div>
          <label class="text-xs text-slate-600">Amount (KES)</label>
          <input id="agent_amount" type="number" class="w-full border p-2 rounded" placeholder="Amount" />
        </div>
        <div>
          <label class="text-xs text-slate-600">Recipient name (for pickup)</label>
          <input id="agent_name" class="w-full border p-2 rounded" placeholder="Name for pickup" />
        </div>
      </div>

      <div class="flex gap-2 mt-4">
        <button class="flex-1 bg-indigo-600 text-white py-2 rounded" onclick="openPinFromModal('agent')">Proceed</button>
        <button class="flex-1 py-2 rounded border" onclick="closeAllActionModals()">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Lipa na M-Pesa Modal (STK mock) -->
  <div id="mpesaModal" class="hidden fixed inset-0 z-60 modal-backdrop flex items-center justify-center p-4">
    <div class="bg-white rounded-lg p-6 w-full max-w-md">
      <h3 class="text-lg font-semibold mb-2">Lipa na M-Pesa (mock)</h3>
      <p class="text-sm text-slate-500 mb-3">Simulate STK push (mock behavior).</p>

      <div class="space-y-2">
        <div>
          <label class="text-xs text-slate-600">Business Number / Till</label>
          <input id="mpesa_biz" class="w-full border p-2 rounded" placeholder="e.g., 123456" />
        </div>
        <div>
          <label class="text-xs text-slate-600">Account / Reference</label>
          <input id="mpesa_ref" class="w-full border p-2 rounded" placeholder="Order ref" />
        </div>
        <div>
          <label class="text-xs text-slate-600">Amount (KES)</label>
          <input id="mpesa_amount" type="number" class="w-full border p-2 rounded" placeholder="Amount" />
        </div>
      </div>

      <div class="flex gap-2 mt-4">
        <button class="flex-1 bg-indigo-600 text-white py-2 rounded" onclick="openPinFromModal('mpesa')">Proceed (STK)</button>
        <button class="flex-1 py-2 rounded border" onclick="closeAllActionModals()">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Pay Bills Modal -->
  <div id="billsModal" class="hidden fixed inset-0 z-60 modal-backdrop flex items-center justify-center p-4">
    <div class="bg-white rounded-lg p-6 w-full max-w-md">
      <h3 class="text-lg font-semibold mb-2">Pay Bills</h3>
      <p class="text-sm text-slate-500 mb-3">Pay utilities and subscriptions.</p>

      <div class="space-y-2">
        <div>
          <label class="text-xs text-slate-600">Bill Type</label>
          <select id="bill_type" class="w-full border p-2 rounded">
            <option value="electricity">Electricity</option>
            <option value="water">Water</option>
            <option value="tv">TV Subscription</option>
            <option value="internet">Internet</option>
          </select>
        </div>
        <div>
          <label class="text-xs text-slate-600">Reference / Account</label>
          <input id="bill_ref" class="w-full border p-2 rounded" placeholder="Account or reference" />
        </div>
        <div>
          <label class="text-xs text-slate-600">Amount (KES)</label>
          <input id="bill_amount" type="number" class="w-full border p-2 rounded" placeholder="Amount" />
        </div>
      </div>

      <div class="flex gap-2 mt-4">
        <button class="flex-1 bg-indigo-600 text-white py-2 rounded" onclick="openPinFromModal('bills')">Proceed</button>
        <button class="flex-1 py-2 rounded border" onclick="closeAllActionModals()">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Transaction Detail Modal -->
  <div id="txDetailModal" class="hidden fixed inset-0 z-70 modal-backdrop flex items-center justify-center p-4">
    <div class="bg-white rounded-lg p-6 w-full max-w-md">
      <h3 id="txDetailTitle" class="text-lg font-semibold mb-2">Transaction</h3>
      <div id="txDetailBody" class="text-sm text-slate-700 space-y-2">
        <!-- filled by JS -->
      </div>
      <div class="flex gap-2 mt-4">
        <button class="flex-1 bg-indigo-600 text-white py-2 rounded" onclick="closeTxDetail()">Close</button>
      </div>
    </div>
  </div>

  <!-- PIN / Re-auth Modal (centered) -->
  <div id="pinModal" class="hidden fixed inset-0 modal-backdrop pin-modal">
    <div id="pinBox" class="modal-content">
      <h3 class="text-lg font-semibold mb-3">Enter PIN to continue</h3>
      <p class="text-sm text-slate-500 mb-3">This action requires your 4-6 digit PIN.</p>
      <input id="pinInput" type="password" maxlength="6" class="w-full border p-2 rounded mb-4" placeholder="Your PIN" />
      <div class="flex gap-2">
        <button class="flex-1 bg-indigo-600 text-white py-2 rounded" onclick="verifyPin()">Unlock</button>
        <button class="flex-1 py-2 rounded border" onclick="cancelPin()">Cancel</button>
      </div>
      <p id="pinMsg" class="text-sm mt-2 text-red-500 hidden"></p>
    </div>
  </div>

  <!-- small toast -->
  <div id="toastWrap" class="fixed bottom-6 right-6 z-90"></div>

  <!-- Add Account Modal -->
  <div id="acctModal" class="hidden fixed inset-0 z-60 modal-backdrop flex items-center justify-center p-4">
    <div class="bg-white rounded-lg p-6 w-full max-w-sm">
      <h3 id="acctModalTitle" class="text-lg font-semibold mb-3">Add Account</h3>
      <input id="acctNameInput" class="w-full border p-2 rounded mb-3" placeholder="Account name (e.g., Savings)"/>
      <input id="acctInitInput" type="number" class="w-full border p-2 rounded mb-3" placeholder="Starting balance (KES)" />
      <div class="flex gap-2">
        <button class="flex-1 bg-green-600 text-white py-2 rounded" onclick="saveAccount()">Save</button>
        <button class="flex-1 py-2 rounded border" onclick="closeAcctModal()">Cancel</button>
      </div>
    </div>
  </div>

  <!--MOBILE HTML CODE FOR MOBILE MODUAL NAVIGATIONS-->
 <!-- MOBILE: Slide-up Fullscreen Settings (bottom sheet) -->
<div id="mobileSettingsSheet" class="fixed inset-0 z-[9970] hidden">
  <div class="absolute inset-0 bg-black/40" id="mobileSettingsBackdrop"></div>
  <div class="fixed left-0 right-0 bottom-0 mx-auto w-full max-w-md rounded-t-2xl bg-white shadow-2xl transform translate-y-full transition-transform duration-300" id="mobileSettingsPanel" style="max-height:92vh;">
    <div class="p-4 border-b flex items-center justify-between">
     <!-- MOBILE PROFILE HEADER -->
<div class="p-2 bg-white rounded-xl shadow-sm" id="mobileProfileBox">

  <div class="flex items-center gap-3 cursor-pointer" onclick="toggleMobileProfileEdit()">
    <!-- Avatar -->
    <div class="w-12 h-12 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-700 font-semibold overflow-hidden"
         id="mobileSettingAvatar">
      U
    </div>

    <div>
      <div id="mobileSettingName" class="font-semibold text-base">User</div>
      <div id="mobileSettingPhone" class="text-xs text-slate-400">+254...</div>
    </div>
  </div>

  <!-- EXPANDABLE EDIT AREA -->
  <div id="mobileProfileEdit" class="hidden mt-4 space-y-3">

    <!-- Change Avatar -->
    <div class="flex flex-col">
      <label class="text-sm font-semibold">Change Avatar</label>
      <input type="file" id="mobileAvatarInput" accept="image/*"
             class="text-sm" onchange="previewMobileAvatar()">
    </div>

    <!-- Change Name -->
    <div class="flex flex-col">
      <label class="text-sm font-semibold">Name</label>
      <input id="mobileNameInput"
             type="text"
             class="border rounded-lg px-3 py-2 text-sm">
    </div>

    <button onclick="saveMobileProfileChanges()"
            class="w-full bg-indigo-600 text-white py-2 rounded-lg">
      Save Changes
    </button>

  </div>
</div>

      <button class="text-slate-500" onclick="closeMobileSettings()">‚úï</button>
    </div>

    <div class="p-4 overflow-auto" style="max-height:calc(92vh - 64px);">
      <!-- Theme -->
      <div class="mb-4">
        <label class="text-xs text-slate-600">Theme</label>
        <select id="mobileThemeSelect" class="w-full border p-2 rounded mt-2 text-sm">
          <option value="default">Default</option>
          <option value="purple">Purple</option>
          <option value="blue">Blue</option>
          <option value="dark">Dark</option>
          <option value="amoled">AMOLED</option>
        </select>
      </div>

      <!-- Recovery question -->
      <div class="mb-4">
        <label class="text-xs text-slate-600">Recovery Question</label>
        <select id="mobileRecoveryQ" class="w-full border p-2 rounded mt-2 text-sm">
          <option value="">‚Äî choose ‚Äî</option>
          <option value="mother_maiden">What is your mother's maiden name?</option>
          <option value="first_school">What was your first school's name?</option>
          <option value="fav_teacher">What is your favorite teacher's name?</option>
        </select>
        <input id="mobileRecoveryA" class="w-full border p-2 rounded mt-2" placeholder="Answer (keep secret)" />
      </div>

      <!-- Change PIN quick -->
      <div class="mb-4">
        <label class="text-xs text-slate-600">Change PIN</label>
        <button class="w-full px-3 py-2 bg-indigo-600 text-white rounded mt-2" onclick="showChangePinModal()">Change PIN</button>
        <p class="text-xs text-slate-400 mt-2">PIN change uses secure modal. Desktop settings also available.</p>
      </div>

      <!-- Danger / Logout -->
      <div class="mb-4">
        <button class="w-full py-3 rounded bg-red-600 text-white" onclick="mobileDeleteAccountConfirm()">Delete account</button>
        <button class="w-full py-3 mt-2 rounded border" onclick="logout()">Logout</button>
      </div>

      <div class="text-xs text-slate-400 text-center mt-4">Mobile settings ‚Äî small, fast, and local</div>
    </div>
  </div>
</div>

<!-- MOBILE: Activity Page (slide-up) -->
<div id="mobileActivitySheet"
     class="fixed inset-0 z-[9970] hidden flex flex-col">

  <!-- BACKDROP -->
  <div class="absolute inset-0 bg-black/30" id="mobileActivityBackdrop"></div>

  <!-- PANEL -->
  <div id="mobileActivityPanel"
       class="mt-auto w-full max-w-md mx-auto bg-white rounded-t-2xl shadow-2xl transform translate-y-full transition-transform duration-300 flex flex-col"
       style="height: 92vh;">

      <!-- HEADER -->
      <div class="p-3 border-b flex items-center justify-between">
        <div class="font-semibold">Activity</div>
        <button class="text-slate-500" onclick="closeMobileActivity()">‚úï</button>
      </div>

      <!-- CONTENT (scrollable) -->
      <div id="mobileActivityList"
           class="flex-1 overflow-y-auto p-3 space-y-3">
      </div>
  </div>
</div>


<!-- MOBILE: Slide-up Drawer (right side) -->
<div id="mobileDrawer" class="fixed inset-0 z-[9960] hidden">
  <div class="absolute inset-0 bg-black/30" id="mobileDrawerBackdrop"></div>
      <div id="mobileDrawerPanel" class="fixed right-0 top-0 bottom-0 w-[78%] max-w-xs bg-white shadow-2xl transform translate-x-full transition-transform duration-300">
        <div class="p-4 border-b flex items-center justify-between">
          <div class="font-semibold">Menu</div>
          <button class="text-slate-500" onclick="hideSlideUpDrawer()">‚úï</button>
        </div>
        <div class="p-4 space-y-3 overflow-auto">
          <button class="w-full text-left py-3 rounded hover:bg-slate-50" onclick="showAddAccount(); hideSlideUpDrawer()">+ Add Account</button>

          <!-- Mobile Accounts List -->
          <div id="mobileAccountsList" class="mt-2 max-h-60 overflow-y-auto border rounded p-2">
            <!-- accounts will be rendered here -->
          </div>

          <button class="w-full text-left py-3 rounded hover:bg-slate-50" onclick="startAction('mpesa'); hideSlideUpDrawer()">Lipa na M-Pesa</button>
          <button class="w-full text-left py-3 rounded hover:bg-slate-50" onclick="startAction('bills'); hideSlideUpDrawer()">Pay Bills</button>
          <button class="w-full text-left py-3 rounded hover:bg-slate-50" onclick="openSupport(); hideSlideUpDrawer()">Support</button>
        </div>
      </div>
</div>

<!-- MOBILE: Generic Bottom Sheet placeholder (for confirmations) -->
<div id="mobileSettingsSheet"
     class="fixed inset-0 z-[9970] hidden flex flex-col">

  <div class="absolute inset-0 bg-black/40" id="mobileSettingsBackdrop"></div>

  <div id="mobileSettingsPanel"
       class="mt-auto w-full max-w-md mx-auto bg-white rounded-t-2xl shadow-2xl transform translate-y-full transition-transform duration-300 flex flex-col"
       style="height: 92vh;">

      <!-- HEADER -->
      <div class="p-4 border-b flex items-center justify-between">
        <h2 class="font-semibold">Settings</h2>
        <button onclick="closeMobileSettings()" class="text-slate-500 text-xl">‚úï</button>
      </div>

      <!-- CONTENT (scrollable) -->
      <div class="flex-1 overflow-y-auto p-4 space-y-4" id="mobileSettingsContent">
      </div>
  </div>
</div>

<!-- ‚úÖ MOBILE BOTTOM NAV (SHOULD ALWAYS SHOW ON SMALL SCREENS) -->
<nav id="mobileNavBar" class="fixed bottom-0 left-0 w-full bg-white shadow-lg border-t md:hidden z-[9980]">
  <ul class="flex justify-around text-slate-600 text-center">

    <li class="flex-1">
      <button data-nav="home" class="nav-btn w-full py-3 flex flex-col items-center">
        <span class="text-xl">üè†</span>
        <span class="text-[11px]">Home</span>
      </button>
    </li>

    <li class="flex-1">
      <button data-nav="send" class="nav-btn w-full py-3 flex flex-col items-center">
        <span class="text-xl">üì§</span>
        <span class="text-[11px]">Send</span>
      </button>
    </li>

    <li class="flex-1">
      <button data-nav="activity" class="nav-btn w-full py-3 flex flex-col items-center">
        <span class="text-xl">üìä</span>
        <span class="text-[11px]">Activity</span>
      </button>
    </li>

    <li class="flex-1">
      <button data-nav="settings" class="nav-btn w-full py-3 flex flex-col items-center">
        <span class="text-xl">‚öôÔ∏è</span>
        <span class="text-[11px]">Settings</span>
      </button>
    </li>

  </ul>
</nav>

<!--DASHBOARD JAVASCRISPT SCRIPT-->
  <script src="dashboard.js"></script>
 <script>
  function toggleMobileProfileEdit() {
    const box = document.getElementById("mobileProfileEdit");
    box.classList.toggle("hidden");
    if (!box.classList.contains("hidden")) {
      document.getElementById("mobileNameInput").value = user.name || "";
    }
  }

  function previewMobileAvatar() {
    const file = document.getElementById("mobileAvatarInput").files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = () => {
      const avatarEl = document.getElementById("mobileSettingAvatar");
      avatarEl.innerHTML = `<img src="${reader.result}" class="w-full h-full rounded-full object-cover" />`;
      user.avatar = reader.result;
      saveUser(user);
    };
    reader.readAsDataURL(file);
  }

  function saveMobileProfileChanges() {
    const newName = document.getElementById("mobileNameInput").value.trim();
    if (!newName) { showToast("Name cannot be empty"); return; }
    user.name = newName;
    saveUser(user);
    document.getElementById("mobileSettingName").textContent = newName;
    showToast("Profile updated successfully");
    document.getElementById("mobileProfileEdit").classList.add("hidden");
  }

  function loadMobileProfile() {
    document.getElementById("mobileSettingName").textContent = user.name || "User";
    document.getElementById("mobileSettingPhone").textContent = user.phone || "+254...";
    const avatarEl = document.getElementById("mobileSettingAvatar");
    if (user.avatar) {
      avatarEl.innerHTML = `<img src="${user.avatar}" class="w-full h-full rounded-full object-cover" />`;
    } else {
      avatarEl.textContent = (user.name || "U")[0].toUpperCase();
    }
  }
</script>

</body>
</html>
